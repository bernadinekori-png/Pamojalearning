<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Dashboard</title>
<link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet">
<link rel="stylesheet" href="admin.css">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <button id="adminSidebarToggle" class="hamburger" aria-label="Toggle navigation">
    <i class='bx bx-menu'></i>
  </button>

<!-- Sidebar -->
<div class="sidebar">
  <h2>Admin Panel</h2>
  <a href="admin.html"><i class='bx bxs-dashboard'></i> Dashboard</a>
  <a href="managetutor.html"><i class='bx bx-user'></i> Manage Tutors</a>
  <a href="managest.html"><i class='bx bx-group'></i> Manage Students</a>
  <a href="announce.html"><i class='bx bx-bell'></i> Announcements</a>
  <a href="settings.html"><i class='bx bx-cog'></i> Settings</a>
</div>

<!-- Main Content -->
<div class="main-content">
  <!-- Header -->
  <div class="header">
    <h1>Welcome, Admin</h1>
    <div class="header-right">
      <button class="logout">Logout</button>
    </div>
  </div>

  <!-- KPI Cards -->
  <div class="card-container">
    <div class="card card-tutors">
      <h3>Total Tutors</h3>
      <p id="totalTutors">0</p>
    </div>
    <div class="card card-students">
      <h3>Total Students</h3>
      <p id="totalStudents">0</p>
    </div>
    <div class="card card-announcements">
      <h3>Total Announcements</h3>
      <p id="totalAnnouncements">0</p>
    </div>
  </div>

  <!-- Recent Activities Table -->
  <div class="recent-activities">
    <h2>Recent Activities</h2>
    <table>
      <thead>
        <tr>
          <th>Activity</th>
          <th>User</th>
          <th>Date</th>
        </tr>
      </thead>
      <tbody id="activitiesTable"></tbody>
    </table>
  </div>
</div>

<!-- JS Script -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  const logoutLink = document.querySelector('.logout');
  const sidebarToggle = document.getElementById('adminSidebarToggle');

  if (sidebarToggle) {
    sidebarToggle.addEventListener('click', function () {
      document.body.classList.toggle('sidebar-open');
    });
  }

  // --- Logout ---
  logoutLink.addEventListener('click', function(e) {
    e.preventDefault();
    if (confirm('Are you sure you want to logout?')) {
      localStorage.clear();
      window.location.href = 'filee.html';
    }
  });

  // --- KPI Cards ---
  async function fetchKPIs() {
    const token = localStorage.getItem('token');
    try {
      const res = await fetch('http://localhost:5000/api/admin/kpis', { headers:{ 'Authorization': `Bearer ${token}` } });
      const data = await res.json();
      document.getElementById('totalTutors').textContent = data.totalTutors;
      document.getElementById('totalStudents').textContent = data.totalStudents;
      document.getElementById('totalAnnouncements').textContent = data.totalAnnouncements;
    } catch(e){ console.error(e); }
  }

  // --- Recent Activities Table ---
  async function fetchActivities() {
    const token = localStorage.getItem('token');
    try {
      const res = await fetch('http://localhost:5000/api/admin/recent-activities', { headers:{ 'Authorization': `Bearer ${token}` } });
      const activities = await res.json();
      const tbody = document.getElementById('activitiesTable');
      tbody.innerHTML='';
      activities.forEach(a=>{
        const tr = document.createElement('tr');
        tr.innerHTML=`<td>${a.activity}</td><td>${a.user}</td><td>${new Date(a.date).toLocaleString()}</td>`;
        tbody.appendChild(tr);
      });
    } catch(e){ console.error(e); }
  }

  fetchKPIs();
  fetchActivities();
});
</script>

</body>
</html>
